{
  "title": "Workflow",
  "$schema": "https://github.com/drake/schemas/member#",
  "description": "JSON representation of workflow",
  "accel": "process",
  "type": "object",
  "properties": {
    "process": { "type": "string" },
    "version": { "type": "string" },
    "mode": { "type": "string" },
    "steps": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/definitions/step" }
    }
  },
  "required": [ "process","version","mode","steps" ],
  "additionalProperties": false,
  "definitions": {
    "OptionsDef": {
      "type": "object",
      "patternProperties": {
        "^/([^/]+(/[^/]+)*)?$": {
          "type": "string"
        }
      }
    },
    "IncludeDef": {
      "type": "object",
      "patternProperties": {
        "^/([^/]+(/[^/]+)*)?$": {
          "type": "string"
        }
      }
    },
    "TaskDef": {
      "type": "object",
      "properties": {
        "schemaCommand": { "type": "string" },
        "schemaPath": { "type": "string" },
        "currentTempView": { "type": "string" },
        "category": { "type": "string" },
        "sqlPath": { "type": "string" },
        "sql": { "type": "string" },
        "cache": { "type": "string" },
        "forceCache": { "type": "string" },
        "dataCache": { "type": "string" },
        "cacheScope": { "type": "string" }
      }
    },
    "SeqTaskDef": {
      "type": "object",
      "allOf": [
        {"$ref": "#/definitions/TaskDef"},
        {
          "properties": { "seq": { "type":  "string" } }
        }
      ],
      "required": [ "seq" ]
    },
    "PartsDef": {
      "type": "object",
      "properties": {
        "label": { "type": "string" },
        "replaceLabelEnabled": { "type": "string" },
        "replaceLabelWith": { "type": "string" },
        "skipLabelEnabled": { "type": "string" },
        "skipLabelWith": { "type": "string" }
      }
    },
    "SplitPartConvDef": {
      "type": "object",
      "properties": {
        "parts": { "$ref": "#/definitions/PartsDef" },
        "conversions": {
          "type": "array",
          "minItems": 2,
          "items": { "$ref": "#/definitions/TaskDef" }
        }
      }
    },
    "PostDef": {
      "type": "object",
      "properties": {
        "category": { "type": "string" },
        "currentTempView": { "type": "string" },
        "sqlPath": { "type": "string" },
        "sql": { "type": "string" },
        "cache": { "type": "string" },
        "forceCache": { "type": "string" },
        "dataCache": { "type": "string" },
        "tempView": { "type": "string" }
      }
    },
    "SplitterDef": {
      "type": "object",
      "properties": {
        "splits": {
          "type": "array",
          "minItems": 2,
          "items": { "$ref": "#/definitions/TaskDef" }
        },
        "splitConversions": {
          "type": "array",
          "minItems": 2,
          "items": { "$ref": "#/definitions/SplitPartConvDef" }
        }
      },
      "additionalProperties": false
    },
    "step": {
      "title": "Step",
      "description": "A Step entry",
      "type": "object",
      "properties": {
        "name": { "type": "string" },
        "model": { "type": "string" },
        "format": { "type": "string" },
        "from": { "type": "string" },
        "label": { "type": "string" },
        "options": { "$ref": "#/definitions/OptionsDef" },
        "attributes": { "$ref": "#/definitions/TaskDef" },
        "conversions": {
          "type": "array",
          "minItems": 2,
          "items": { "$ref": "#/definitions/SeqTaskDef" }
        },
        "include": { "$ref": "#/definitions/IncludeDef" },
        "post": { "$ref": "#/definitions/PostDef" },
        "splitter": { "$ref": "#/definitions/SplitterDef" }
      },
      "required": [ "name", "model" ],
      "additionalProperties": false
    }
  }
}